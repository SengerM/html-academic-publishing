<!DOCTYPE html>
<html>

<head>
	<title>Modern scientific documents with HTML</title>
	
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- This fixes the problem of small font (some texts and also the math) in mobile devices, see https://stackoverflow.com/a/35564095/8849755 -->
	<link rel="stylesheet" href="./css_and_scripts/style.css">
	<!-- Math support https://www.mathjax.org/#gettingstarted -->
	<script>
	MathJax = {
	  tex: {
		inlineMath: [['$', '$'], ['\\(', '\\)']]
	  },
	  svg: {
		fontCache: 'global'
	  }
	};
	</script>
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
	
</head>

<body>
	
	<div id="document_title">This will be replaced by the title of the document</div>
		
	<author affiliation="Universität Zürich|Universidad de Buenos Aires" email="thisisnotmyemail@gmail.com">
		Matías Senger
	</author>
	<author	affiliation="Universität Zürich|Asociación de amigos de Humahuaca Unidos por el Pueblo" email="juanca@gmail.com">
		Juan Carlos
	</author>
	<author affiliation="The Pirates University" email="theblackpearl@tortuga.com.pi">
		Captain Jack Sparrow<footnote>Yo ho, yo ho, a pirate's life for me.</footnote>
	</author>
	<author affiliation="Universität Zürich|Princeton|Cambridge|Universidad de Buenos Aires|CERN|Oxford">
		Smart Guy
	</author>
	
	<abstract>
		<p>PDF is the most used format for scientific documents, be them reports, papers, slides, etc. The major advantage of this format is its universality, once a PDF file is produced it is assured that it will be properly rendered in any modern operating system using the appropriate software. However, it has a major drawback: It was designed to represent "paper-printed documents" and so it can only contain static text and images. This limits the way scientists present their results. Furthermore, the rate at which we read documentation is so high that most of the PDFs we read are never printed, we just read them from the screen. In view of this it is reasonable to have a new, modern format for such a purpose. Here I explore how the technologies behind websites can be addapted to this and present an example (this document itself).</p>
		<p>This is a second paragraph in the abstract. Usually there is only one, but we can handle more if needed.</p>
	</abstract>

	<div id="table-of-contents">
		<h2 class="unnumbered">Table of contents</h2> <!-- Feel free to change this title. -->
		<!-- Here will be placed the table of contents -->
	</div>
	
	<h1 id="introduction section">Introduction to HTML Scientific Document</h1>
	
	<p>"HTML Scientific Document" is an evolution to scientific documents in PDF format.</p>
	
	<h2>Why to replace the PDF format?</h2>
	
	<p>PDF is nowadays the most extended format for sharing scientific documents. A PDF document basically represents a bunch of paper sheets. This limits what your document can contain<footnote>Basically you can only put static text and images, that's all.</footnote>. From my point of view:</p>
	<ul>
		<li>Strong points of PDF:
			<ul>
				<li>Unbeatable for representing "printable documents".</li>
				<li>Universal<footnote>Nowadays any operating system has software to handle PDF files.</footnote>.</li>
			</ul>
		</li>
		<li>Weak points of PDF:
			<ul>
				<li>It can only represent "printable documents".</li>
				<li>It is not device friendly<footnote>You can easilly read a PDF in a computer, but reading a PDF in a mobile is a pain becasue you cannot increase the font size.</footnote>.</li>
				<li>It can only contain static text and images.</li>
				<li>You cannot change the font size, i.e. it zooms as an image not as a text.</li>
			</ul>
		</li>
	</ul>
	
	<h2>What can replace the PDF format?</h2>
	
	<p>HTML, the technology behind websites, is as universal as PDFs but much more flexible<footnote>With HTML you can create anything you can imagine, for example <a href="https://www.youtube.com/">YouTube</a>.</footnote>. For me it looks as the perfect candidate for this jump as the hard part (implementing the machinery) is already solved.</p>
	
	<h3>Latex vs HTML</h3>
	
	<p>In physics, math and other related fields of science it is very common to write documents using Latex. Latex is very nice and powerful, it produces amazing PDF files. But this is preciselly the problem I see: It produces PDFs. If you write in Latex it is because in the end you want a PDF.</p>
	<p>HTML, as Latex, is a markup language but, in contrast, it is much more widespread due to its masive usage in websites. The comunity of HTML users is infinitely bigger than the comunity of Latex users. Nowadays there is nothing Latex can do that HTML cannot do (for example beautiful equations). Even more, you don't need to install anything in order to create/view an HTML document because you already have a text editor and a web browser in all your devices.</p>
	<p>In view of this it looks very reasonable for me to choose HTML as the basis for "the next generation of scientific documents" rather than Latex or anything else.</p>
	
	
	<h2>Still want a PDF?</h2>
	
	<p>You still want a PDF? Open this document with your favourite web broser, hit <code>ctrl+print</code> and save it as a PDF file<footnote>Firefox can do this, probably all other "famous" browsers can too. You may have to set up the zoom, margins, background, etc. such that it looks fine as in the browser. But believe me, it is trivial to get a good looking PDF from this.</footnote>. There are probably other ways of getting a PDF from an HTML file.</p>
	
	
	<h1>HTML Scientific Document</h1>
	
	<p>Here I will describe my current approach which produces a document as the one you are reading right now. Still not perfect but, from my point of view, already better than a PDF.</p>
	
	<h2>The structure of the documents</h2>
	
	<p>This is based in HTML so anything that applies to HTML also applies to this. The structure of an HTML-SD must follow the <a href="https://www.w3schools.com/html/html_intro.asp">structure of an HTML document</a>. As an example you can take the source code for this document, just select "view source" with your favourite web browser or download this file (using <code>ctrl+s</code> for example) and open it with a text editor.</p>
	
	<h2>Fully offline and stand alone document</h2>
	
	<p>Though HTML is usually encountered in online applications, off course you can do everything offline. In fact for the current application to scientific documents we would prefer to have a fully offline and standalone document in many cases. HTML Scientific Document was designed with this in mind so to obtain a fully offline and standalone document you just need to append the CSS and JavaScript files together with your HTML.</p>
	<p>Currently the support for math equations requires internet connection.</p>
	
	<h1>Sections and sub-sections</h1>
	
	<p>Scientific documents are structured in sections, sub-sections, sub-sub-sections and so on. To accomplish this in HTML you can use the <code>h1</code>, <code>h2</code>,... tags. The scripting engine of HTML-SD that is linked to this HTML file will automatically number the sections and also produce a table of contents as we are used to in Latex. See <crossref>Code: sections and subsections example</crossref> for an example.</p>
	
	<float class="Code" id="Code: sections and subsections example">
		<floatcaption>Example of how to create sections and sub-sections.</floatcaption>
		<code class="block">&lt;h1>This is a section&lt;/h1>
&lt;p>This is a paragraph.&lt;/p>
&lt;h2>This is a sub-section&lt;/h2>
&lt;p>This is a paragraph within the sub-section.&lt;/p></code>
	</float>
	
	<h2>Unnumbered sections</h2>
	
	<p>To insert unnumbered sections<footnote>Unnumbered sections are not listed in the table of contents and cannot be referenced using <code>&lt;crossref></code>.</footnote> just set the <code>class</code> attribute to <code>"unnumbered"</code>. An example is shown in <crossref>Code: unumbered sections example</crossref>.
	
	<float class="Code" id="Code: unumbered sections example">
		<floatcaption>Unnumbered sections example.</floatcaption>
		<code class="block">&lt;h3 class="unnumbered">This is an unnumbered section&lt;/h3></code>
	</float>
	
	As a result of this you will get the following section:</p>
	
	<h3 class="unnumbered">This is an unnumbered section</h3>
	
	<p>This section will not be listed in the table of contents, it is just aesthetic. You can do this with any type of heading tag.</p>
	
	<h3>Sections with the same name</h3>
	
	<p>You can have sectioins with the same name, but if you do that you must make them different by assigning different <code>id</code>s to each of them. <crossref>Code: sections with the same name</crossref> shows an example. 
	
	<float class="Code" id="Code: sections with the same name">
		<floatcaption>Example of inserting multiple sections with the same name</floatcaption>
		<code class="block">&lt;h1>Numbered sections with the same name&lt;/h1> &lt;!-- This section does not need an id because it is the first one with this name -->
&lt;h1 id="second section with the same name">Numbered sections with the same name&lt;/h1>
&lt;h1 id="third section with the same name">Numbered sections with the same name&lt;/h1></code>
	</float>
	
	By doing this we obtain, for example, <crossref>Two sections with the same name</crossref> and <crossref>I want two sections with the same title</crossref>.</p>
	
	<h3>Two sections with the same name</h3>
	
	<p>This section has the same name as <crossref>I want two sections with the same title</crossref>, but they are different by the <code>id</code> attribute<footnote>The <code>id</code> attribute is not rendered in an HTML document so you will not see it in your web browser.</footnote>.</p>
	
	<h3 id="I want two sections with the same title">Two sections with the same name</h3>
	
	<p>This section has the same name as <crossref>Two sections with the same name</crossref>.Two sections with the same name require at least one of them with a different id. Otherwise they are the same section and we don't know which of them to refer to when there is a cross reference.</p>
	
	<h1>Mathematic equations</h1>
	
	<p>You can just write your equations using Latex code. For example <code>$x^2+x+1=0$</code> becomes $x^2+x+1=0$ and <code>$$e^{i\pi}+1=0$$</code> becomes $$e^{i\pi}+1=0$$</p>
	
	<h2>Numbered equations</h2>
	
	<p> To insert a numbered equation use the <code>equation</code> tag as shown in <crossref>Code: numbered equation example</crossref>.
	
	<float class="Code" id="Code: numbered equation example">
		<floatcaption>Numbered equation example.</floatcaption>
		<code class="block">&lt;equation id="my first equation">$$\intop_0^\frac{\pi}{2} f(x)~dx=1$$&lt;/equation></code>
	</float>
	
	As a result we get:
	
		<equation id="my first equation">$$\intop_0^\frac{\pi}{2} f(x)~dx=1$$</equation>
		
	Here we have an important equation in physics:
		<equation id="Dirac equation">$$\left( i \gamma^\mu \partial_\mu - m \right) \psi = 0$$</equation>
	</p>
	
	<h3>Very long equations</h3>
	
	<p>If you wrote in Latex before you probably know that there are always problems with "very long" equations and this is a pain because you never know beforehand when an equation is "very long". Here this problem does not exist! Consider the following "very long equation":
		
			<equation id="very long equation">$$\frac{dF}{dx}\frac{dx}{dy}\frac{dy}{d\xi}=\intop_{\mathbb{R}}f(\zeta)e^{-\zeta}\cos(w^{2}-\zeta)\ d\zeta+\frac{3x^{3}+(\nabla\times\boldsymbol{E})\cdot\boldsymbol{B}}{\vec{r}\cdot\vec{E}}+8\pi\hbar+\log\cos\tan\sin\pi$$</equation>
			
		Now reduce the width of the window in which you are reading this and see what happens when this equation becomes "very long". You can simply scrool horizontally to see it complete<footnote>If this were a PDF produced with Latex, this equation would probably be problematic by going out of the page.</footnote>.</p>
	
	<h3 id="Custom Latex command deffinitions">Custom Latex commands</h3>
	
	<p>It is also possible to define custom Latex commands for the equations. Suppose you are working with quantum mechanics and you are using the <a href="https://en.wikipedia.org/wiki/Bra%E2%80%93ket_notation">bracket notation</a>. You can define the <code>\KET</code> command as you would do in Latex inserting <code>\def\KET#1{\left|#1\right\rangle }</code> and then you can use it to write, for example, the Schrödinger equation via <code>\hat{\mathscr{H}}\KET{\psi}=i\frac{\partial}{\partial t}\KET{\psi}</code>. The result is:
		$\def\KET#1{\left|#1\right\rangle }$
		$$ \hat{\mathscr{H}}\KET{\psi}=i\frac{\partial}{\partial t}\KET{\psi} $$
	</p>
	
	<h1>Floats</h1>
	
	<p>In Latex we have a powerful and useful resource which are the <a href="https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions#Custom_floats">floats</a>. A figure and a table are examples of floats. To obtain a float here we use the <code>float</code> tag. Within <code>&lt;float></code> and <code>&lt;/float></code> you put whatever content you want and (mandatory) a caption using <code>floatcaption</code><footnote>I wanted to use <code>caption</code> instead of <code>floatcaption</code>, which is more intuitive and easier, but there is some weird behavior with it in HTML and unfortunately it is not possible to use for this.</footnote>. To assign the "type of float" (figure, table, video, whatever you want) you have to specify its <code>class</code> attribute. Whatever you assign to the <code>class</code> attribute will be used to create/increase a counter for such class of floats and will be displayed in the captions and cross references. See <crossref>Code: example of float</crossref> for an example.</p>
	
	<float class="Code" id="Code: example of float">
		<floatcaption>Example of usage of <code>float</code>.</floatcaption>
		<code class="block">&lt;float class="Code" id="Code: example of float">
	&lt;floatcaption>Example of usage of &lt;code>float&lt;/code>.&lt;/floatcaption>
	Put here whatever you want, an image, a code, a video, etc.
&lt;/float></code>
	</float>
	
	<h2>Custom floats</h2>
	
	<p>As said before the <code>class</code> attribute of a <code>float</code> element specifies the type of float it is, e.g. a figure or a table. Nothing stops you from creating your own types of floats. For example you can create the floats of type <code>Video</code> or <code>Code</code> or whatever you want. To do this just insert a float of the class you want and it is automatically created. Simple and easy<footnote>In fact the usual float types <code>Figure</code> and <code>Table</code> are not specifically defined here, they are created on the fly just as any other type you may want to use.</footnote>. Each type of float will have its own counter for numbbering them, and in the caption they will be labeled according to their <code>class</code> attribute.</p>
	<p>Please note that the <code>class</code> attribute of a <code>float</code> element is case sensitive, i.e. <code>&lt;float class="Figure"></code> is different than <code>&lt;float class="figure"></code>.</p>
	
	<h2>Floats examples</h2>
	
	<p>Below I left some examples of <code>float</code>s. All the codes, such as <crossref>Code: example of float</crossref>, are floats of class <code>Code</code>.</p>
	
	<float class="Figure" id="figure with Newton in full width">
		<image src="media/Inkscape.svg" width="100%" style="max-height: 44vh"></image>
		<floatcaption>This is a <code>float</code> of class <code>Figure</code>. Note that the class is the word used to identify this type of float and automatically asign a number to it, and it is case sensitive. So a <code>figure</code> will be different than a <code>Figure</code>.</floatcaption>
	</float>
	
	<p>Some random text, bla bla bla.</p>
	
	<float>
		<image src="media/Inkscape.svg" width="100%" style="max-height: 44vh"></image>
		<floatcaption>This is a <code>float</code> without class. Basically it contains something (e.g. an image) with a caption that is not numbered. It cannot have a <code>crossref</code> pointing to it. I don't know why would someone use this, but it is possible.</floatcaption>
	</float>
	
	<p>More random text.</p>
	
	<float class="Figure" id="another figure I like">
		<image 
			src="https://www.planetware.com/wpimages/2020/02/france-in-pictures-beautiful-places-to-photograph-eiffel-tower.jpg" 
			style="max-height: 44vh; max-width: 100%;"
		></image>
		<floatcaption>The image in this figure has undefined width and height, only the <code>max-height</code> and <code>max-width</code> properties were defined. As a consequence it automatically changes its size depending on the viewport (window) size until one of the maximum width or height is achieved. This is really useful because it should not fail in a mobile.</floatcaption>
	</float>
	
	<p>In <crossref>foto del obelisco de Buenos Aires</crossref> you can see a view of Buenos Aires, the capital city of Argentina.</p>
	
	<float class="Figure" id="foto del obelisco de Buenos Aires">
		<image 
			src="https://blog.friendlyrentals.com/uploads/2018/05/PrImg_3573.jpg" 
			width=555
		></image>
		<floatcaption>This image has the width fixed (and thus also its height). This image will not change as a function of the window size. In a mobile it may overflow.</floatcaption>
	</float>
	
	<p>A PDF cannot handle a plot made with <a href="https://plotly.com/">plotly</a> as the one in <crossref>FIG: interactive plot</crossref>. This plot is interactive, you can zoom, pan, enable/disable traces, etc. This has proven to be very useful to me when showing my results to other scientists as you don't need to produce many versions of the same plot with different zooming conditions.</p>
	
	<float class="Figure" id="FIG: interactive plot">
		<iframe class="plotly" src="media/Reconstruction error mean.html" style="width: 555px ! important;"></iframe>
		<floatcaption>This plot is interactive, it was produced using the nice Python package <a href="https://plotly.com/">plotly</a>. Note that despite this float is a Figure, you can put whatever content you want inside. In this case we have an interactive snippet with a plot.</floatcaption>
	</float>
	
	<p>Of course we can make this plots to fill the full width of the window so they change as we reshape the window. See for example the plot in <crossref>measured delay average</crossref>. If you change the width of this window the plot will automatically adapt itself. Cool!</p>
	
	<float class="Figure" id="measured delay average">
		<floatcaption>Note that you can place the caption above the figure, not only below. Just place the <code>floatcaption</code> tag where you want the caption to be.</floatcaption>
		<iframe class="plotly" src="media/Measured delay average vs set delay.html" style="min-width: 444px;"></iframe>
	</float>
	
	<p>Another nice point of these "interactive plots" is that the font size in the legend/labels matches the font size of the document, so if you zoom in or out, or open this in a mobile, the text will render properly. Try to <code>ctrl+wheel</code><footnote>Or whatever command you use in your browser to change the zoom.</footnote> to change the zoom of this window and see how the text and markers in these plots are modified.</p>
	
	<p>The <code>float</code> objects can be of any class that is good for your purpose. For example see <crossref>Adios Nonino Astor Piazzolla</crossref> which is of class <code>Video</code>.</p>
	
	<float class="Video" id="Adios Nonino Astor Piazzolla">
		<iframe 
			src="https://www.youtube.com/embed/Vt0lQdyEmXk"
			frameborder="0"
			style="height: 50vh;"
			width="80%"
		></iframe>
		<floatcaption>Adiós Nonino by Ástor Piazzolla, interpreted by Ayelén di Montezemolo.</floatcaption>
	</float>
	
	<h1 id="Section: crossrefs">Cross referencing</h1>
	
	<p>To insert a cross reference you have to use the <code>crossref</code> tag. Within this tag you have to put the <code>id</code> of the object you want to refer to. For example <crossref>my first equation</crossref> has <code>id="my first equation"</code>. To cite this equation we proceed as shown in <crossref>Code: crossref example</crossref>.
	
	<float class="Code" id="Code: crossref example">
		<floatcaption><code>crossref</code> usage example.</floatcaption>
		<code class="block">&lt;p>The solution $f(x)$ to &lt;crossref>my first equation&lt;/crossref> is $f(x)=\sin(x)$.&lt;/p></code>
	</float>
	
	The code shown in <crossref>Code: crossref example</crossref> produces this: The solution $f(x)$ to <crossref>my first equation</crossref> is $f(x)=\sin(x)$.
	</p>
	
	
	<p>We can use <code>crossref</code> to make reference to
		<ul>
			<li>Equations, e.g. <crossref>my first equation</crossref>, <crossref>Dirac equation</crossref> and <crossref>very long equation</crossref>.</li>
			<li>Sections, e.g. <crossref>introduction section</crossref> and <crossref>Why to replace the PDF format?</crossref>.</li>
			<li>Floats, e.g. <crossref>Code: sections and subsections example</crossref>, <crossref>Code: numbered equation example</crossref>, <crossref>foto del obelisco de Buenos Aires</crossref> and <crossref>Adios Nonino Astor Piazzolla</crossref>.</li>
			<li>Bibliography, e.g. <crossref>paper EPR</crossref>. (See <crossref>Section: bibliography</crossref> for more details.)</li>
		</ul>
		The machinery implemented here automatically knows what type of object you are refering to and inserts the proper text, creates the link and the popup bubble on mouse hover.
	</p>
	
	<h2>Cross referencing sections without the need of adding an id</h2>
	
	<p>Since the title of a section is almost an <code>id</code>, you can use <code>crossref</code> with sections without the need of adding a specific <code>id</code> to the section, you can just use the title of such section. For example <crossref>Cross referencing sections without the need of adding an id</crossref> has no <code>id</code> defined, it is just <code>&lt;h2>Cross referencing sections without the need of adding an id&lt;/h2></code> and despite it has no <code>id</code> I can still do <code>&lt;crossref>Cross referencing sections without the need of adding an id&lt;/crossref></code> and obtain: <crossref>Cross referencing sections without the need of adding an id</crossref>.</p>
	<p>Note that in this case the name of the section is used as its <code>id</code> so if you change the name you will broke the reference. So be careful!</p>
	
	<h1>Footnotes</h1>
	
	<p>You can add footnotes by using the <code>footnote</code> tag like this: <code>&lt;footnote>footnote content&lt;/footnote></code>, which whill produce this:<footnote>footnote content</footnote>. This is another example of footnote<footnote>This is a footnote. We can have an equation $e^{i\pi}+1=0$.</footnote>.</p>
	<p>Of course footnotes can have crossrefs within them<footnote>Many times footnotes make references to equations, like equation <crossref>Dirac equation</crossref> for example.</footnote><footnote>You can also place many consecutive footnotes one after the other.</footnote>.</p>
	
	<h1 id="Section: bibliography">Bibliography and citations</h1>
	
	<p>To insert bibliography first we create create <code>reference</code> elements and then we cite them just using <code>crossref</code> in the same way as detailed in <crossref>Section: crossrefs</crossref>. So, for example <code>&lt;reference id="book Jackson Classical Electrodynamics">Jackson, J. D. (1999). Classical electrodynamics.&lt;/reference></code> creates a bibliography entry and then we can just use <code>crossref</code> with its <code>id</code>. Before being able to use this there is one last step which is to place our list of references. For this just create a <code>div</code> element with id <code>references_list</code> anywhere in your document (usually in the end).</p>
	<p>A complete example for creating the bibliography is shown in <crossref>Code: bibliography example</crossref>.
	
	<float class="Code" id="Code: bibliography example">
		<floatcaption>Example for creating bibliography and external references</floatcaption>
		<code class="block">&lt;!-- Put this wherever you want your list of references to be shown. -->
&lt;div id="references_list">
	&lt;h1 class="unnumbered">References&lt;/h1> &lt;!-- This title is optional, it is just a decoration. -->
	&lt;!-- We create the "reference" elements within the "references_list" so we keep everything together -->
	&lt;reference id="book Jackson Classical Electrodynamics">Jackson, J. D. (1999). Classical electrodynamics.&lt;/reference>
	&lt;reference id="paper EPR">Einstein, A., B. Podolsky, and N. Rosen. “Can Quantum-Mechanical Description of Physical Reality Be Considered Complete?” Physical Review 47, no. 10 (May 15, 1935): 777–80. &lt;a href="https://doi.org/10.1103/PhysRev.47.777">https://doi.org/10.1103/PhysRev.47.777&lt;/a>.&lt;/reference>
	&lt;reference id="paper Bell">Bell, John Stewart. “On the Einstein Podolsky Rosen Paradox” 1, no. 3 (1964): 6.&lt;/reference>
&lt;/div></code>
	</float>
	
	Now we can simply insert <code>crossref</code>s to the <code>reference</code> elements we have defined and obtain: <crossref>book Jackson Classical Electrodynamics</crossref>, <crossref>paper EPR</crossref> and <crossref>paper Bell</crossref>. Note that they are automatically ordered and that unused <code>reference</code> elements will be not displayed.
	</p>
	
	<h1>Code</h1>
	
	<p>To insert code we use the standard tag <code>code</code>. For inline code like <code>this one</code> just write <code>&lt;code>this one&lt;/code></code>. For non-inline code we set the class to <code>block</code>, see code <crossref>Code: block code syntax</crossref> for example.</p>
	
	<float class="Code" id="Code: block code syntax">
		<floatcaption>Example of block code.</floatcaption>
		<code class="block">&lt;code class="block">
	Put here your code
&lt;/code></code>
	</float>
	
	<p>By using the syntax shown in code <crossref>Code: block code syntax</crossref> we get, for example, the code <crossref>Code of the FPGA</crossref>.</p>
	
	<float class="Code" id="Code of the FPGA">
		<floatcaption>This is my code for the sequencer in the FPGA for testing the TDC.</floatcaption>
		<code class="block">`timescale 1ns/1ps

module sequencer_for_TDC_V1_SW_28_10_19 (
	//-------------------------------------------------------------------//
	// This is the sequencer module to interface with the test structure //
	// that I am calling "TDC_V1_SW_28_10_19" which is the one produced  //
	// by S. Widerkehr that contains 4 TDC test structures.              //
	//-------------------------------------------------------------------//
	input clk,
	input reset,

	input run_sequencer, // Setting this to 1 starts the sequencer.
	input [7:0]t_start_coarse,
	input [7:0]t_stop_coarse,

	output ready_flag, // 1 means that the sequencer is ready to start a new run, 0 means it is not.
	output reg measure_flag, // This is what Beat called "measure".
	output reg write, // This tells the RAM memory when to write.
	output reg[15:0]data, // This sends the data to the RAM memory.

	// TDC_V1_SW_28_10_19 test structure ---//
	output reg [3:0]SEL,                    //
	output reg PSTART,                      //
	output reg PSTOP,                       //
	output reg RES,                         //
	input [6:0]DOUT,                        //
	input [20:0]SAFF                        //
	// -------------------------------------//
);
	// State machine states --------------------------------------//
	localparam SM_IDLE = 5'd0;                                    //
	localparam SM_WAIT_FOR_RUN_SIGNAL = 5'd1;                     //
	localparam SM_START_MEASURE_SEQUENCE = 5'd2;                  //
	localparam SM_MEASURE_SEQUENCE = 5'd3;                        //
	localparam SM_READOUT_SEQUENCE = 5'd4;                        //
	reg [4:0]current_state;                                       //
	reg [4:0]previous_state;                                      //
	wire state_did_not_change = previous_state == current_state;  //
	// -----------------------------------------------------------//
	
	reg [9:0]current_state_time_count; // This counts the number of clock cycles that the state machine has been in the "current_state" state. Each time the state changes, this will be reseted to 0.
	
	assign ready_flag = (current_state == SM_WAIT_FOR_RUN_SIGNAL);
	
	always @(posedge clk or posedge reset) begin
		if (reset) begin
			current_state <= SM_IDLE;
			previous_state <= SM_IDLE;
			current_state_time_count <= 9'd0;
			SEL <= 4'b0000;
			PSTART <= 1'b0;
			PSTOP <= 1'b0;
			RES <= 1'b1;
			measure_flag <= 1'b0;
			write <= 1'b0; end
		else begin // if NOT reset
			if (state_did_not_change) begin
				current_state_time_count <= current_state_time_count + 9'd1; end
			else begin
				previous_state <= current_state;
				current_state_time_count <= 9'd0; end
			case (current_state) // State machine machinery ---
				SM_IDLE: begin
					SEL <= 4'b0000;
					PSTART <= 1'b0;
					PSTOP <= 1'b0;
					RES <= 1'b1;
					current_state <= SM_WAIT_FOR_RUN_SIGNAL; end
				SM_WAIT_FOR_RUN_SIGNAL: begin
					if (run_sequencer) current_state <= SM_START_MEASURE_SEQUENCE; end
				SM_START_MEASURE_SEQUENCE: begin
					measure_flag <= 1'b1;
					RES <= 0; // Remove the "reset" signal from the test structure.
					current_state <= SM_MEASURE_SEQUENCE; end
				SM_MEASURE_SEQUENCE: begin: measure_sequence
					if (current_state_time_count[7:0] == t_start_coarse)
						PSTART <= 1;
					if (current_state_time_count[7:0] >= t_stop_coarse) begin
						PSTOP <= 1;
						if (current_state_time_count[7:0] == t_stop_coarse + 2) begin // Finish the measure sequence. I am waiting some time (i.e. t_stop_coarse + something) so any transient in the test structure finishes. The sime scale in the test structure is in the order of pico seconds so a few number of clock cycles here (order nano second) should be enough.
							current_state <= SM_READOUT_SEQUENCE;
							measure_flag <= 1'b0; end/*if*/ end end/*measure_sequence*/
				SM_READOUT_SEQUENCE: begin: readout_mechanism
					reg [2:0]write_counter; // This counter is used to write the many bytes from each TDC into the memory.
					if (SEL == 4'b0000) begin
						SEL <= 4'b0001;
						write_counter <= 3'b000; end
					else begin
						write_counter <= write_counter + 3'd1;
						case (write_counter)
							0: data[15:0] <= {DOUT[6:0], 4'd0, SAFF[20:16]}; // This will be written to the memory in the base board module.
							1: write <= 1'b1; // This will tell the memory block in the base board to write the data.
							2: write <= 1'b0; // Disable writing.
							3: data[15:0] <= SAFF[15:0]; // Select the remaining data.
							4: write <= 1'b1; // Write to the memory.
							5: write <= 1'b0;
							6: begin
								SEL <= {SEL<<1}; // Move to the next TDC structure.
								write_counter <= 3'd0; // Reset the write counter so for the next TDC structure we repeat the cycle again.
								if (SEL == 4'b1000) // If we are in the last test structure...
									current_state <= SM_IDLE; // When the last TDC was read, we have finished.
								end
							endcase
						end
					end
				endcase
			end
		end
	endmodule
		</code>
	</float>
	
	<p>Note that code can be outside a <code>float</code> element, for example: <code class="block">This is my code
I like this code
This code is not inside a float element so you cannot insert a crossref to refer to this code, but you can still insert code in this way and it will be displayed cool
Lalala</code></p>
	
	<h1>Documentation and reference</h1>
	
	<h2>Template</h2>
	
	<p>You can use the document you are reading right now as a template. It has everything you need in it. To get the source code visit <a href="https://github.com/SengerM/html-academic-publishing/blob/main/index.html">this link</a> or just open this file with a text editor<footnote>If you are in a web browser: "File&nbsp;→&nbsp;Save&nbsp;page&nbsp;as" and then open it with your favourite text editor.</footnote>.</p>
	
	<h2>Github repo</h2>
	
	<p>You can also download the source code of this file and the CSS and JavaScript that produces this output from <a href="https://github.com/SengerM/html-academic-publishing">this Github repo</a>.</p>
	
	<h2>Examples</h2>
	
	<p>There is currently one example, see file <a href="examples/1964_Bell/Bell_1964_On the Einstein Podolsky Rosen paradox.html">examples/1964_Bell/Bell_1964_On the Einstein Podolsky Rosen paradox.html</a>.</p>
	
	<h2>Still-to-do list</h2>
	
	<p>Though this is already looking good, there is still much work to do:</p>
	<ul>
		<li>Implement acronyms.</li>
		<li>Improve <code>code</code> of class <code>block</code> to get syntax highlighting, lines numbering, etc.</li>
		<li>Implement a translator Latex → this.</li>
		<li>Provide offline support for math equations.</li>
	</ul>
	
	<div id="references_list">
		<h1 class="unnumbered">References</h1>
		<reference id="book Jackson Classical Electrodynamics">Jackson, J. D. (1999). Classical electrodynamics.</reference>
		<reference id="paper EPR">Einstein, A., B. Podolsky, and N. Rosen. “Can Quantum-Mechanical Description of Physical Reality Be Considered Complete?” Physical Review 47, no. 10 (May 15, 1935): 777–80. <a href="https://doi.org/10.1103/PhysRev.47.777">https://doi.org/10.1103/PhysRev.47.777</a>.</reference>
		<reference id="paper Bell">Bell, John Stewart. “On the Einstein Podolsky Rosen Paradox” 1, no. 3 (1964): 6.</reference>
	</div>
	
	<div id="footnotes_list">
		<h1 class="unnumbered">Footnotes</h2>
	</div>
		
	<script src="./css_and_scripts/script.js"></script>
	<script src="./css_and_scripts/authors.js"></script>
</body>

</html>
